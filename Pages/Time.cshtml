@page
@model SE1StudentTracker.Pages.TimeModel
@{
    ViewData["Title"] = "Time/Tracking Page";

}


<body>
    <form method="post">
        @Html.AntiForgeryToken()
    </form>

    <h2>Clock In / Out</h2>
    <div class="container">
        <select id="location">
            <option value="" disabled selected hidden>-- Select Location --</option>
            <option value="Surgery">Surgery</option>
            <option value="Maternity Ward">Maternity Ward</option>
            <option value="Intensive Care Unit">Intensive Care Unit</option>
            <option value="Emergency Room">Emergency Room</option>
        </select>

        <button id="clockInBtn">Clock In</button>
        <button id="clockOutBtn">Clock Out</button>
    </div>

    <div id="status">

    </div>
    

    <script>
        document.addEventListener("DOMContentLoaded", () => {

            const locationSelect = document.getElementById("location");
            const clockInBtn = document.getElementById("clockInBtn");
            const clockOutBtn = document.getElementById("clockOutBtn");
            const statusDiv = document.getElementById("status");

            let currentLocation = "";
            let clockInTime = null;


            const token = document.querySelector('input[name="__RequestVerificationToken"]').value;

            function clockIn(Location) {
                fetch('https://localhost:7007/Time?handler=ClockIn', {
                    method: 'POST',
                    body: JSON.stringify({
                        location: Location
                    }),
                    headers: {
                        "Content-type": "application/json; charset=UTF-8",
                        "RequestVerificationToken": token
                    }
                });
            };

            let clockedIn = false;

            clockInBtn.addEventListener("click", function () {
                const locationSelected = locationSelect.value;

                if (!locationSelected) {
                    statusDiv.textContent = "Please select a location before clocking in.";
                    statusDiv.style.color = "red";
                    return;
                }

                if (clockedIn) {
                    statusDiv.textContent = `You are already clocked in at ${currentLocation}.`;
                    statusDiv.style.color = "orange";
                    return;
                }

                clockIn(locationSelected);

                clockedIn = true;

                clockInBtn.disabled = true;
                clockOutBtn.disabled = false;
                locationSelect.disabled = true;
                currentLocation = locationSelected;
                clock_in_at = new Date();

                statusDiv.textContent = `Clocked in at ${currentLocation} at ${clock_in_at.toLocaleTimeString()}.`;
                statusDiv.style.color = "green";
            });

            // ClockOutForm.addEventListener("submit", (event) => {
            //     if (!clockedIn) {
            //         statusDiv.textContent = "You need to clock in first.";
            //         statusDiv.style.color = "red";
            //         return;
            //     }

            //     clockedIn = false;
            //     clockInBtn.disabled = false;
            //     clockOutBtn.disabled = true;
            //     locationSelect.disabled = false;

            //     statusDiv.textContent = `Clocked out from ${currentLocation} at ${clockOutTime.toLocaleTimeString()} (Session: ${duration} minutes).`;
            //     statusDiv.style.color = "blue";
            // });
        });
    </script>
</body>