@page
@model SE1StudentTracker.Pages.AdminModel
@using System.Data
@{
    ViewData["Title"] = "Admin SQL Console";
}

<h2>Admin SQL Console</h2>

<form method="post">
    <div>
        <label for="sql">SQL Query:</label><br />
        <textarea id="sql" name="Sql" rows="10" style="width:100%;">@Model.Sql</textarea>
    </div>
    <div style="margin-top:8px;">
        <input type="checkbox" id="allow" name="AllowChanges" value="true" @(Model.AllowChanges ? "checked" : "") />
        <label for="allow">Allow changes (commit transaction)</label>
    </div>
    <div style="margin-top:8px;">
        <button type="submit" class="btn btn-primary">Run</button>
    </div>
    @Html.AntiForgeryToken()
</form>

@if (!string.IsNullOrEmpty(Model.ResultMessage))
{
    <div style="margin-top:12px;">
        <strong>Result:</strong> @Model.ResultMessage
    </div>
}

@if (Model.Exception != null)
{
    <div style="margin-top:12px;color:red;">
        <strong>Error:</strong> @Model.Exception.Message
    </div>
}

@if (Model.ResultTable != null)
{
    <table class="table table-striped table-sm" style="margin-top:12px;">
        <thead>
            <tr>
                @foreach (DataColumn col in Model.ResultTable.Columns)
                {
                    <th>@col.ColumnName</th>
                }
            </tr>
        </thead>
        <tbody>
            @foreach (DataRow row in Model.ResultTable.Rows)
            {
                <tr>
                    @foreach (var cell in row.ItemArray)
                    {
                        <td>@(cell ?? "")</td>
                    }
                </tr>
            }
        </tbody>
    </table>
}